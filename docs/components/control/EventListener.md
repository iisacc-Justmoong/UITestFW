# EventListener

Location: `qml/components/control/util/EventListener.qml`

`EventListener` is an embeddable behavior layer that routes pointer, keyboard, wheel, and global runtime events to a custom `action` callback.

## Trigger Set

- Pointer-local: `clicked`, `pressed`, `released`, `entered`, `exited`, `hoverChanged`
- Wheel: `wheel`
- Keyboard: `keyPressed`, `keyReleased`
- Global runtime: `globalPressed`, `globalContextRequested`

## Core Properties

- `trigger` (string)
- `action` (function)
- `enabled` (bool)
- `acceptedButtons` (mouse button mask)
- `includeUiHit` (include UI hit-test in payload)
- `preferBackendState` (default `true`, backend-first input snapshot)
- `includeBackendSummary` (append backend summary into payload)
- `macControlClickAsRight` (control+left as context gesture)

## Payload Behavior

For global triggers, payload includes:
- coordinates (`x`, `y`, `globalX`, `globalY`)
- button/modifier state
- `ui` hit-test result (optional)
- `input` snapshot (backend-first)

For context requests, deduplication logic suppresses duplicate events generated by overlapping mouse/context pipelines.

## Backend-First Resolution

When `preferBackendState` is enabled:

1. `Backend.hookUserEvents()` is ensured.
2. `Backend.currentUserInputState()` is used first.
3. Fallback to `RuntimeEvents.inputState()` if backend data is empty.

UI hit resolution uses `RuntimeEvents.hitTestUiAt()` and then falls back to `input.pointerUi` when needed.

## Usage

```qml
import LVRS 1.0 as LV

LV.EventListener {
    trigger: "globalContextRequested"
    action: function(eventData) {
        console.log(eventData.globalX, eventData.globalY, eventData.ui.path)
    }
}
```

## Typical Patterns

- Context menu dispatch by UI target.
- Global click monitoring for overlay dismissal.
- Wheel routing into nested scroll containers (`WheelScrollGuard` uses this).
