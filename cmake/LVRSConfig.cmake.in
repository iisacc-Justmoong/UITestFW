@PACKAGE_INIT@

set(LVRS_LAYOUT_VERSION "1")
set(LVRS_RUNTIME_PLATFORMS
    macos
    linux
    windows
    ios
    android
    wasm
)

function(_lvrs_config_detect_platform out_var)
    set(_lvrs_platform unknown)
    if(CMAKE_SYSTEM_NAME STREQUAL "Android")
        set(_lvrs_platform android)
    elseif(CMAKE_SYSTEM_NAME STREQUAL "iOS")
        set(_lvrs_platform ios)
    elseif(CMAKE_SYSTEM_NAME STREQUAL "Emscripten")
        set(_lvrs_platform wasm)
    elseif(CMAKE_SYSTEM_NAME STREQUAL "Darwin")
        if(CMAKE_OSX_SYSROOT MATCHES "iphone")
            set(_lvrs_platform ios)
        else()
            set(_lvrs_platform macos)
        endif()
    elseif(CMAKE_SYSTEM_NAME STREQUAL "Windows")
        set(_lvrs_platform windows)
    elseif(CMAKE_SYSTEM_NAME STREQUAL "Linux")
        set(_lvrs_platform linux)
    endif()
    set(${out_var} "${_lvrs_platform}" PARENT_SCOPE)
endfunction()

function(_lvrs_config_default_android_sdk_hint out_var)
    set(_lvrs_sdk_hint "")
    if(DEFINED ENV{ANDROID_SDK_ROOT} AND IS_DIRECTORY "$ENV{ANDROID_SDK_ROOT}")
        set(_lvrs_sdk_hint "$ENV{ANDROID_SDK_ROOT}")
    elseif(DEFINED ENV{ANDROID_HOME} AND IS_DIRECTORY "$ENV{ANDROID_HOME}")
        set(_lvrs_sdk_hint "$ENV{ANDROID_HOME}")
    elseif(CMAKE_HOST_SYSTEM_NAME STREQUAL "Darwin")
        if(IS_DIRECTORY "$ENV{HOME}/Library/Android/sdk")
            set(_lvrs_sdk_hint "$ENV{HOME}/Library/Android/sdk")
        endif()
    else()
        if(IS_DIRECTORY "$ENV{HOME}/Android/Sdk")
            set(_lvrs_sdk_hint "$ENV{HOME}/Android/Sdk")
        endif()
    endif()
    set(${out_var} "${_lvrs_sdk_hint}" PARENT_SCOPE)
endfunction()

function(_lvrs_config_default_android_ndk_hint sdk_root out_var)
    set(_lvrs_ndk_hint "")
    if(DEFINED ENV{CMAKE_ANDROID_NDK} AND IS_DIRECTORY "$ENV{CMAKE_ANDROID_NDK}")
        set(_lvrs_ndk_hint "$ENV{CMAKE_ANDROID_NDK}")
    elseif(DEFINED ENV{ANDROID_NDK_ROOT} AND IS_DIRECTORY "$ENV{ANDROID_NDK_ROOT}")
        set(_lvrs_ndk_hint "$ENV{ANDROID_NDK_ROOT}")
    elseif(DEFINED ENV{ANDROID_NDK_HOME} AND IS_DIRECTORY "$ENV{ANDROID_NDK_HOME}")
        set(_lvrs_ndk_hint "$ENV{ANDROID_NDK_HOME}")
    elseif(NOT "${sdk_root}" STREQUAL "" AND IS_DIRECTORY "${sdk_root}/ndk")
        file(GLOB _lvrs_ndk_versions LIST_DIRECTORIES true "${sdk_root}/ndk/*")
        set(_lvrs_ndk_dirs "")
        foreach(_lvrs_ndk_version_dir IN LISTS _lvrs_ndk_versions)
            if(IS_DIRECTORY "${_lvrs_ndk_version_dir}")
                list(APPEND _lvrs_ndk_dirs "${_lvrs_ndk_version_dir}")
            endif()
        endforeach()
        if(_lvrs_ndk_dirs)
            list(SORT _lvrs_ndk_dirs)
            list(REVERSE _lvrs_ndk_dirs)
            list(GET _lvrs_ndk_dirs 0 _lvrs_ndk_hint)
        endif()
    endif()
    set(${out_var} "${_lvrs_ndk_hint}" PARENT_SCOPE)
endfunction()

function(_lvrs_config_default_emsdk_hint out_var)
    set(_lvrs_emsdk_hint "")
    if(DEFINED ENV{EMSDK} AND IS_DIRECTORY "$ENV{EMSDK}")
        set(_lvrs_emsdk_hint "$ENV{EMSDK}")
    endif()
    set(${out_var} "${_lvrs_emsdk_hint}" PARENT_SCOPE)
endfunction()

if(NOT EXISTS "${CMAKE_CURRENT_LIST_DIR}/LVRSTargets.cmake")
    _lvrs_config_detect_platform(_lvrs_dispatch_platform)
    if(_lvrs_dispatch_platform STREQUAL "unknown")
        message(FATAL_ERROR
            "LVRS root package dispatcher could not infer runtime platform from "
            "CMAKE_SYSTEM_NAME='${CMAKE_SYSTEM_NAME}' and CMAKE_OSX_SYSROOT='${CMAKE_OSX_SYSROOT}'.")
    endif()

    set(_lvrs_dispatch_prefix "${CMAKE_CURRENT_LIST_DIR}/platforms/${_lvrs_dispatch_platform}")
    set(_lvrs_dispatch_config "${_lvrs_dispatch_prefix}/lib/cmake/LVRS/LVRSConfig.cmake")
    if(NOT EXISTS "${_lvrs_dispatch_config}")
        message(FATAL_ERROR
            "LVRS root package dispatcher did not find platform config: ${_lvrs_dispatch_config}")
    endif()

    set(LVRS_ACTIVE_PLATFORM "${_lvrs_dispatch_platform}")
    set(LVRS_ACTIVE_PREFIX "${_lvrs_dispatch_prefix}")
    include("${_lvrs_dispatch_config}")
    return()
endif()

include(CMakeFindDependencyMacro)
find_dependency(Qt6 6.5 REQUIRED COMPONENTS Quick QuickControls2 Qml Svg Network)

include("${CMAKE_CURRENT_LIST_DIR}/LVRSTargets.cmake")

set(LVRS_ACTIVE_PREFIX "${PACKAGE_PREFIX_DIR}")
if(NOT DEFINED LVRS_ACTIVE_PLATFORM OR LVRS_ACTIVE_PLATFORM STREQUAL "")
    _lvrs_config_detect_platform(_lvrs_local_platform)
    set(LVRS_ACTIVE_PLATFORM "${_lvrs_local_platform}")
    unset(_lvrs_local_platform)
endif()

set(LVRS_QML_IMPORT_PATH "@PACKAGE_LVRS_QML_MODULE_INSTALL_BASE@")
set(LVRS_QML_MODULE_PATH "@PACKAGE_LVRS_QML_MODULE_INSTALL_DIR@")

set(LVRS_QT_HOST_PREFIX_HINT "")
set(LVRS_QT_IOS_PREFIX_HINT "")
set(LVRS_QT_ANDROID_PREFIX_HINT "")
set(LVRS_QT_WASM_PREFIX_HINT "")
if(DEFINED Qt6_DIR AND NOT Qt6_DIR STREQUAL "")
    get_filename_component(LVRS_QT_HOST_PREFIX_HINT "${Qt6_DIR}/../../.." ABSOLUTE)
    get_filename_component(_lvrs_qt_version_root "${LVRS_QT_HOST_PREFIX_HINT}" DIRECTORY)
    if(EXISTS "${_lvrs_qt_version_root}/ios/lib/cmake/Qt6/Qt6Config.cmake")
        set(LVRS_QT_IOS_PREFIX_HINT "${_lvrs_qt_version_root}/ios")
    endif()
    if(EXISTS "${_lvrs_qt_version_root}/android_arm64_v8a/lib/cmake/Qt6/Qt6Config.cmake")
        set(LVRS_QT_ANDROID_PREFIX_HINT "${_lvrs_qt_version_root}/android_arm64_v8a")
    elseif(EXISTS "${_lvrs_qt_version_root}/android/lib/cmake/Qt6/Qt6Config.cmake")
        set(LVRS_QT_ANDROID_PREFIX_HINT "${_lvrs_qt_version_root}/android")
    endif()

    set(_lvrs_qt_wasm_candidates
        wasm_singlethread
        wasm_multithread
        wasm_32
        wasm
    )
    foreach(_lvrs_wasm_candidate IN LISTS _lvrs_qt_wasm_candidates)
        if(EXISTS "${_lvrs_qt_version_root}/${_lvrs_wasm_candidate}/lib/cmake/Qt6/Qt6Config.cmake")
            set(LVRS_QT_WASM_PREFIX_HINT "${_lvrs_qt_version_root}/${_lvrs_wasm_candidate}")
            break()
        endif()
    endforeach()
    unset(_lvrs_wasm_candidate)
    unset(_lvrs_qt_wasm_candidates)
    unset(_lvrs_qt_version_root)
endif()

_lvrs_config_default_android_sdk_hint(_lvrs_android_sdk_hint)
set(LVRS_ANDROID_SDK_HINT "${_lvrs_android_sdk_hint}")
_lvrs_config_default_android_ndk_hint("${LVRS_ANDROID_SDK_HINT}" _lvrs_android_ndk_hint)
set(LVRS_ANDROID_NDK_HINT "${_lvrs_android_ndk_hint}")
_lvrs_config_default_emsdk_hint(_lvrs_emsdk_hint)
set(LVRS_EMSDK_HINT "${_lvrs_emsdk_hint}")
unset(_lvrs_android_sdk_hint)
unset(_lvrs_android_ndk_hint)
unset(_lvrs_emsdk_hint)

# Qt's qml plugin auto-link path expects a plain target name ("LVRSCoreplugin")
# from LVRS module metadata. Provide a compatibility imported target so downstream
# projects do not need to define custom aliases.
if(NOT TARGET LVRSCoreplugin)
    if(TARGET LVRS::LVRSCoreplugin)
        add_library(LVRSCoreplugin INTERFACE IMPORTED)
        set_target_properties(LVRSCoreplugin PROPERTIES
            INTERFACE_LINK_LIBRARIES "LVRS::LVRSCoreplugin"
        )
    else()
        set(_lvrs_plugin_location "")
        set(_lvrs_plugin_candidates
            "${LVRS_QML_MODULE_PATH}/${CMAKE_SHARED_LIBRARY_PREFIX}LVRSCoreplugin${CMAKE_SHARED_LIBRARY_SUFFIX}"
            "${LVRS_QML_MODULE_PATH}/LVRSCoreplugin${CMAKE_SHARED_LIBRARY_SUFFIX}"
            "${LVRS_QML_MODULE_PATH}/${CMAKE_STATIC_LIBRARY_PREFIX}LVRSCoreplugin${CMAKE_STATIC_LIBRARY_SUFFIX}"
            "${LVRS_QML_MODULE_PATH}/LVRSCoreplugin${CMAKE_STATIC_LIBRARY_SUFFIX}"
        )

        foreach(_lvrs_plugin_candidate IN LISTS _lvrs_plugin_candidates)
            if(EXISTS "${_lvrs_plugin_candidate}")
                set(_lvrs_plugin_location "${_lvrs_plugin_candidate}")
                break()
            endif()
        endforeach()

        if(_lvrs_plugin_location STREQUAL "")
            file(GLOB _lvrs_plugin_globbed
                "${LVRS_QML_MODULE_PATH}/*LVRSCoreplugin*${CMAKE_SHARED_LIBRARY_SUFFIX}"
                "${LVRS_QML_MODULE_PATH}/*LVRSCoreplugin*${CMAKE_STATIC_LIBRARY_SUFFIX}"
            )
            list(SORT _lvrs_plugin_globbed)
            if(_lvrs_plugin_globbed)
                list(GET _lvrs_plugin_globbed 0 _lvrs_plugin_location)
            endif()
        endif()

        if(NOT _lvrs_plugin_location STREQUAL "")
            add_library(LVRSCoreplugin UNKNOWN IMPORTED)
            set_target_properties(LVRSCoreplugin PROPERTIES
                IMPORTED_LOCATION "${_lvrs_plugin_location}"
                INTERFACE_LINK_LIBRARIES "LVRS::LVRS"
            )
        else()
            add_library(LVRSCoreplugin INTERFACE IMPORTED)
            set_target_properties(LVRSCoreplugin PROPERTIES
                INTERFACE_LINK_LIBRARIES "LVRS::LVRS"
            )
        endif()

        unset(_lvrs_plugin_candidate)
        unset(_lvrs_plugin_candidates)
        unset(_lvrs_plugin_globbed)
        unset(_lvrs_plugin_location)
    endif()
endif()

if(NOT TARGET LVRS::LVRSCoreplugin)
    add_library(LVRS::LVRSCoreplugin INTERFACE IMPORTED)
    if(TARGET LVRSCoreplugin)
        set_target_properties(LVRS::LVRSCoreplugin PROPERTIES
            INTERFACE_LINK_LIBRARIES "LVRSCoreplugin"
        )
    else()
        set_target_properties(LVRS::LVRSCoreplugin PROPERTIES
            INTERFACE_LINK_LIBRARIES "LVRS::LVRS"
        )
    endif()
endif()

if(NOT TARGET LVRSCoreplugin)
    add_library(LVRSCoreplugin INTERFACE IMPORTED)
    set_target_properties(LVRSCoreplugin PROPERTIES
        INTERFACE_LINK_LIBRARIES "LVRS::LVRSCoreplugin"
    )
endif()

include("${CMAKE_CURRENT_LIST_DIR}/LVRSHelpers.cmake")

check_required_components(LVRS)
